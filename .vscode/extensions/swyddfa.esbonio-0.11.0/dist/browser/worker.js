var serverExportVar;(()=>{"use strict";var e={470:e=>{function r(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function n(e,r){for(var n,t="",o=0,i=-1,a=0,s=0;s<=e.length;++s){if(s<e.length)n=e.charCodeAt(s);else{if(47===n)break;n=47}if(47===n){if(i===s-1||1===a);else if(i!==s-1&&2===a){if(t.length<2||2!==o||46!==t.charCodeAt(t.length-1)||46!==t.charCodeAt(t.length-2))if(t.length>2){var l=t.lastIndexOf("/");if(l!==t.length-1){-1===l?(t="",o=0):o=(t=t.slice(0,l)).length-1-t.lastIndexOf("/"),i=s,a=0;continue}}else if(2===t.length||1===t.length){t="",o=0,i=s,a=0;continue}r&&(t.length>0?t+="/..":t="..",o=2)}else t.length>0?t+="/"+e.slice(i+1,s):t=e.slice(i+1,s),o=s-i-1;i=s,a=0}else 46===n&&-1!==a?++a:a=-1}return t}var t={resolve:function(){for(var e,t="",o=!1,i=arguments.length-1;i>=-1&&!o;i--){var a;i>=0?a=arguments[i]:(void 0===e&&(e=process.cwd()),a=e),r(a),0!==a.length&&(t=a+"/"+t,o=47===a.charCodeAt(0))}return t=n(t,!o),o?t.length>0?"/"+t:"/":t.length>0?t:"."},normalize:function(e){if(r(e),0===e.length)return".";var t=47===e.charCodeAt(0),o=47===e.charCodeAt(e.length-1);return 0!==(e=n(e,!t)).length||t||(e="."),e.length>0&&o&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return r(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,n=0;n<arguments.length;++n){var o=arguments[n];r(o),o.length>0&&(void 0===e?e=o:e+="/"+o)}return void 0===e?".":t.normalize(e)},relative:function(e,n){if(r(e),r(n),e===n)return"";if((e=t.resolve(e))===(n=t.resolve(n)))return"";for(var o=1;o<e.length&&47===e.charCodeAt(o);++o);for(var i=e.length,a=i-o,s=1;s<n.length&&47===n.charCodeAt(s);++s);for(var l=n.length-s,c=a<l?a:l,f=-1,h=0;h<=c;++h){if(h===c){if(l>c){if(47===n.charCodeAt(s+h))return n.slice(s+h+1);if(0===h)return n.slice(s+h)}else a>c&&(47===e.charCodeAt(o+h)?f=h:0===h&&(f=0));break}var g=e.charCodeAt(o+h);if(g!==n.charCodeAt(s+h))break;47===g&&(f=h)}var u="";for(h=o+f+1;h<=i;++h)h!==i&&47!==e.charCodeAt(h)||(0===u.length?u+="..":u+="/..");return u.length>0?u+n.slice(s+f):(s+=f,47===n.charCodeAt(s)&&++s,n.slice(s))},_makeLong:function(e){return e},dirname:function(e){if(r(e),0===e.length)return".";for(var n=e.charCodeAt(0),t=47===n,o=-1,i=!0,a=e.length-1;a>=1;--a)if(47===(n=e.charCodeAt(a))){if(!i){o=a;break}}else i=!1;return-1===o?t?"/":".":t&&1===o?"//":e.slice(0,o)},basename:function(e,n){if(void 0!==n&&"string"!=typeof n)throw new TypeError('"ext" argument must be a string');r(e);var t,o=0,i=-1,a=!0;if(void 0!==n&&n.length>0&&n.length<=e.length){if(n.length===e.length&&n===e)return"";var s=n.length-1,l=-1;for(t=e.length-1;t>=0;--t){var c=e.charCodeAt(t);if(47===c){if(!a){o=t+1;break}}else-1===l&&(a=!1,l=t+1),s>=0&&(c===n.charCodeAt(s)?-1==--s&&(i=t):(s=-1,i=l))}return o===i?i=l:-1===i&&(i=e.length),e.slice(o,i)}for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!a){o=t+1;break}}else-1===i&&(a=!1,i=t+1);return-1===i?"":e.slice(o,i)},extname:function(e){r(e);for(var n=-1,t=0,o=-1,i=!0,a=0,s=e.length-1;s>=0;--s){var l=e.charCodeAt(s);if(47!==l)-1===o&&(i=!1,o=s+1),46===l?-1===n?n=s:1!==a&&(a=1):-1!==n&&(a=-1);else if(!i){t=s+1;break}}return-1===n||-1===o||0===a||1===a&&n===o-1&&n===t+1?"":e.slice(n,o)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,r){var n=r.dir||r.root,t=r.base||(r.name||"")+(r.ext||"");return n?n===r.root?n+t:n+"/"+t:t}(0,e)},parse:function(e){r(e);var n={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return n;var t,o=e.charCodeAt(0),i=47===o;i?(n.root="/",t=1):t=0;for(var a=-1,s=0,l=-1,c=!0,f=e.length-1,h=0;f>=t;--f)if(47!==(o=e.charCodeAt(f)))-1===l&&(c=!1,l=f+1),46===o?-1===a?a=f:1!==h&&(h=1):-1!==a&&(h=-1);else if(!c){s=f+1;break}return-1===a||-1===l||0===h||1===h&&a===l-1&&a===s+1?-1!==l&&(n.base=n.name=0===s&&i?e.slice(1,l):e.slice(s,l)):(0===s&&i?(n.name=e.slice(1,a),n.base=e.slice(1,l)):(n.name=e.slice(s,a),n.base=e.slice(s,l)),n.ext=e.slice(a,l)),s>0?n.dir=e.slice(0,s-1):i&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};t.posix=t,e.exports=t},83:e=>{e.exports='from typing import Literal\nfrom typing import Union\n\nfrom pygls.protocol import default_converter\n\nfrom esbonio.lsp import __version__\nfrom esbonio.lsp import create_language_server\nfrom esbonio.lsp.sphinx import DEFAULT_MODULES\nfrom esbonio.lsp.sphinx import SphinxLanguageServer\n\n\ndef esbonio_converter():\n    converter = default_converter()\n    converter.register_structure_hook(Union[Literal["auto"], int], lambda obj, _: obj)\n\n    return converter\n\n\nserver = create_language_server(\n    SphinxLanguageServer,\n    DEFAULT_MODULES,\n    name="esbonio",\n    version=__version__,\n    converter_factory=esbonio_converter,\n)\nserver.start_pyodide()\n'}},r={};function n(t){var o=r[t];if(void 0!==o)return o.exports;var i=r[t]={exports:{}};return e[t](i,i.exports,n),i.exports}var t={};(()=>{var e=t;Object.defineProperty(e,"__esModule",{value:!0}),importScripts("https://cdn.jsdelivr.net/pyodide/v0.22.1/full/pyodide.js");const r=n(470),o=n(83);function i(e){if(!e.trim())return;const r=JSON.parse(e);console.debug(r),postMessage(r)}let a=!1;async function s(e,r){const n=e.FS,t=r.fileUri.path;l(n,r.parentUri.path);let o=n.open(t,"w+"),i=r.content;console.debug(`Writing file: ${t}`),n.write(o,i,0,i.length,0),n.close(o)}function l(e,n){try{e.stat(n)}catch(t){let o=r.dirname(n);try{e.stat(o)}catch(r){l(e,o)}e.mkdir(n)}}const c=async function(){return console.debug("Initializing pyodide"),await loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.22.1/full/"})}();onmessage=async e=>{let r=e.data;console.debug(r);let n=await c;if(r.jsonrpc)return a||await async function(e){console.debug("Installing dependencies."),await e.loadPackage(["micropip"]),await e.runPythonAsync("\n  import sys\n  import micropip\n\n  await micropip.install('setuptools')\n  await micropip.install('esbonio')\n  "),console.debug("Loading server."),e.globals.get("sys").stdout.write=i,await e.runPythonAsync(o),a=!0}(n),self.client_message=JSON.stringify(r),void await n.runPythonAsync("\n    import json\n    from js import client_message\n\n    message = json.loads(client_message, object_hook=server.lsp._deserialize_message)\n    server.lsp._procedure_handler(message)\n    ");"writeFile"===r.op?await s(n,r):console.error(`Unknown operation: ${r.op}`)}})(),serverExportVar=t})();
//# sourceMappingURL=worker.js.map